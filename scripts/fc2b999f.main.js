(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};L.mapbox.accessToken="pk.eyJ1IjoibWdhIiwiYSI6IldfSmVWeFkifQ.Uy4kxEzM5s1IPB59wStQMg",a=function(){function a(a){this.nextEvent=b(this.nextEvent,this),this.togglePlayPause=b(this.togglePlayPause,this),this.voices={},this.gain=0,this.minZoom=18,this.maxZoom=21,this.voices.yes=new Beep.Voice("1A♭").setOscillatorType("square").setGainHigh(.01),this.voices.no=new Beep.Voice("1A♮").setOscillatorType("square").setGainHigh(.01),this.voices.fix=new Beep.Voice("1A♯").setOscillatorType("square").setGainHigh(.01),this.voices.color=new Beep.Voice("2B♭").setOscillatorType("square").setGainHigh(.01),this.voices.address=new Beep.Voice("3C♭").setOscillatorType("square").setGainHigh(.01),this.voices.polygonfix=new Beep.Voice("4D♭").setOscillatorType("square").setGainHigh(.01),this.voices.toponym=new Beep.Voice("5E♭").setOscillatorType("square").setGainHigh(.01),this.map=L.mapbox.map("map","nypllabs.g6ei9mm0",{zoomControl:!1,animate:!0,scrollWheelZoom:!1,attributionControl:!1,minZoom:this.minZoom,maxZoom:this.maxZoom,dragging:!0}),L.control.zoom({position:"topright"}).addTo(this.map),L.easyButton("fa-play",this.togglePlayPause,"PLAY/PAUSE",this.map,"play_pause"),this.poly_style={stroke:!1,fillColor:"#000",opacity:.2},this.overlay=L.mapbox.tileLayer("https://s3.amazonaws.com/maptiles.nypl.org/859/859spec.json",{detectRetina:!1,minZoom:this.minZoom,maxZoom:this.maxZoom}),this.overlay.addTo(this.map),this.map.on("load",function(a){return function(){return a.initMap()}}(this)),this.map.on("zoomend",function(a){return function(){return a.onMapZoom()}}(this))}return a.prototype.togglePlayPause=function(){return this.playing?(this.stopAnimation(),$(".fa-pause").removeClass("fa-pause").addClass("fa-play")):(this.startAnimation(),$(".fa-play").removeClass("fa-play").addClass("fa-pause"))},a.prototype.initMap=function(){var a;return a=new L.LatLngBounds,$.getJSON("./geojson/polygons-226.geojson",function(b){return function(c){return b.poly_json=c,b.poly_layer=L.geoJson(c,{style:function(a){return b.poly_style}}),a.extend(b.poly_layer.getBounds()),b.map.fitBounds(a),b.getHistory()}}(this))},a.prototype.onMapZoom=function(){var a,b;return b=this.map.getZoom(),a=.02*(b-this.minZoom),this.voices.yes.setGainHigh(.01+a),this.voices.no.setGainHigh(.01+a),this.voices.fix.setGainHigh(.01+a),this.voices.color.setGainHigh(.01+a),this.voices.address.setGainHigh(.01+a),this.voices.polygonfix.setGainHigh(.01+a),this.voices.toponym.setGainHigh(.01+a)},a.prototype.getHistory=function(){return $.getJSON("./geojson/history-226.geojson",function(a){return function(b){return a.history=b.features}}(this))},a.prototype.startAnimation=function(){return $("#help").remove(),this.playing=!0,this.current_event=0,this.nextEvent()},a.prototype.stopAnimation=function(){return this.playing=!1},a.prototype.nextEvent=function(){var a;return a=this.buildEvent(),null!==a&&(a.addTo(this.map),setTimeout(function(b){return function(){return b.killPolygon(a)}}(this),150)),this.current_event++,this.playing&&this.current_event<this.history.length?requestAnimationFrame(this.nextEvent):void 0},a.prototype.buildEvent=function(){var a,b,c,d,e,f,g,h;return d=this.history[this.current_event],c=null,g=d.properties.flag_type,b=d.properties.flag_value,a={},a.no="#AF2228",a.yes="#609846",a.fix="#FFB92D",a.pink="#F1B6BB",a.blue="#00747A",a.yellow="#FF9D00",a.green="#37AD80",a.gray="#303030",a.address="#d75b25",a.toponym="#fff",a.polygonfix="#fff",a.multi="#f0f",f={stroke:!1,fillOpacity:.9},"geometry"===g?(f.fillColor=a[b],e=this.getPolygonForFlag(d.properties.flaggable_id),e[0]&&(c=e[0]),this.increaseElementValue("span.value."+b),h=this.voices[b],h.play(),setTimeout(function(a){return function(){return a.muteVoice(h)}}(this),150)):"address"===g?c=d:"color"===g?(e=this.getPolygonForFlag(d.properties.flaggable_id),e[0]&&(c=e[0]),-1===b.indexOf(",")?(f.fillColor=a[b],this.increaseElementValue("span.value."+b)):(f.fillColor=a.multi,this.increaseElementValue("span.value.multi"))):"toponym"===g?c=d:"polygonfix"===g&&(f.fillColor=a[g],c=d),"geometry"!==g&&(h=this.voices[g],h.play(),setTimeout(function(a){return function(){return a.muteVoice(h)}}(this),150)),this.increaseElementValue("span.value."+g),this.increaseElementValue("span.value.total"),null===c?null:L.geoJson(c,{pointToLayer:function(b,c){return L.circle(c,3,{color:a[g],fillOpacity:.75,opacity:.5})},style:f})},a.prototype.increaseElementValue=function(a){var b,c,d;return c=$("#legend"),b=$(c.find(a)[0]),d=parseInt(b.text()),d++,b.text(d)},a.prototype.getIndexForFlag=function(a){var b,c,d,e,f,g;for(f=this.history,g=[],c=d=0,e=f.length;e>d;c=++d)b=f[c],b.properties.id===a&&g.push(c);return g},a.prototype.getPolygonForFlag=function(a){var b,c,d,e,f;for(e=this.poly_json.features,f=[],b=0,c=e.length;c>b;b++)d=e[b],d.properties.id===a&&f.push(d);return f},a.prototype.killPolygon=function(a){return this.map.removeLayer(a)},a.prototype.muteVoice=function(a){return a.pause()},a}(),$(function(){return window._viz=new a})}).call(this);